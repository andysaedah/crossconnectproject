function getBasePath(){return window.AppConfig&&window.AppConfig.basePath||"/"}function apiUrl(e){return getBasePath()+"api/"+e.replace(/^\//,"")}function pageUrl(e){return getBasePath()+e.replace(/^\//,"")}function assetUrl(e){return getBasePath()+e.replace(/^\//,"")}document.addEventListener("DOMContentLoaded",function(){initMobileMenu(),initStateFilter(),initSearch(),initBackToTop(),loadChurches(),loadStates()});let currentState="all",currentDenomination="all",currentSearch="",currentPage=1,isLoading=!1,hasMorePages=!0,searchTimeout=null;function initMobileMenu(){let t=document.getElementById("mobileMenuToggle"),a=document.getElementById("mobileMenuOverlay");var e=document.getElementById("mobileMenuClose");t&&a&&(t.addEventListener("click",()=>{t.classList.toggle("active"),a.classList.toggle("active"),document.body.style.overflow=a.classList.contains("active")?"hidden":""}),e&&e.addEventListener("click",()=>{t.classList.remove("active"),a.classList.remove("active"),document.body.style.overflow=""}),a.addEventListener("click",e=>{e.target===a&&(t.classList.remove("active"),a.classList.remove("active"),document.body.style.overflow="")}))}async function loadStates(){try{var e=await(await fetch(apiUrl("states.php"))).json();e.success&&e.data&&(populateStateFilter(e.data),populateStatePills(e.data),populateMobileMenu(e.data))}catch(e){console.error("Failed to load states:",e)}}function populateStateFilter(e){let a=document.getElementById("stateFilter");a&&e.forEach(e=>{var t=document.createElement("option");t.value=e.slug,t.textContent=e.name,a.appendChild(t)})}function populateStatePills(e){let a=document.getElementById("statePills");var t;a&&(e.slice(0,7).forEach(e=>{var t=document.createElement("button");t.className="state-pill",t.dataset.state=e.slug,t.textContent=e.name,t.addEventListener("click",()=>selectState(e.slug)),a.appendChild(t)}),7<e.length)&&((t=document.createElement("button")).className="state-pill state-pill-more",t.textContent=window.AppConfig?.translations?.viewAll||"View All",t.addEventListener("click",()=>showAllStates(e)),a.appendChild(t))}function populateMobileMenu(e){let a=document.getElementById("mobileMenuContent");var t;a&&((t=document.createElement("a")).href="#",t.className="mobile-menu-item active",t.dataset.state="all",t.textContent=window.AppConfig?.translations?.allStates||"All States",t.addEventListener("click",e=>{e.preventDefault(),selectState("all"),closeMobileMenu()}),a.appendChild(t),e.forEach(t=>{var e=document.createElement("a");e.href="#",e.className="mobile-menu-item",e.dataset.state=t.slug,e.textContent=t.name,e.addEventListener("click",e=>{e.preventDefault(),selectState(t.slug),closeMobileMenu()}),a.appendChild(e)}))}function closeMobileMenu(){var e=document.getElementById("mobileMenuToggle"),t=document.getElementById("mobileMenuOverlay");e&&e.classList.remove("active"),t&&t.classList.remove("active"),document.body.style.overflow=""}function initStateFilter(){var e=document.getElementById("stateFilter"),e=(e&&e.addEventListener("change",e=>{selectState(e.target.value)}),document.querySelector('.state-pill[data-state="all"]'));e&&e.addEventListener("click",()=>selectState("all"))}function selectState(e){currentState=e,currentPage=1,updateStatePillsUI(e),updateMobileMenuUI(e),updateSelectUI(e),loadChurches(!0)}function updateStatePillsUI(t){document.querySelectorAll(".state-pill").forEach(e=>{e.classList.toggle("active",e.dataset.state===t)})}function updateMobileMenuUI(t){document.querySelectorAll(".mobile-menu-item").forEach(e=>{e.classList.toggle("active",e.dataset.state===t)})}function updateSelectUI(e){var t=document.getElementById("stateFilter");t&&(t.value=e)}function showAllStates(e){let a=document.getElementById("statePills");var t;a&&(a.innerHTML="",(t=document.createElement("button")).className="state-pill"+("all"===currentState?" active":""),t.dataset.state="all",t.textContent=window.AppConfig?.translations?.allStates||"All States",t.addEventListener("click",()=>selectState("all")),a.appendChild(t),e.forEach(e=>{var t=document.createElement("button");t.className="state-pill"+(currentState===e.slug?" active":""),t.dataset.state=e.slug,t.textContent=e.name,t.addEventListener("click",()=>selectState(e.slug)),a.appendChild(t)}))}function initSearch(){let t=document.getElementById("searchInput");var e=document.getElementById("searchInputMobile"),a=e=>{let t=e.target.value.trim();searchTimeout&&clearTimeout(searchTimeout),searchTimeout=setTimeout(()=>{currentSearch=t,currentPage=1,loadChurches(!0)},300)};t&&t.addEventListener("input",a),e&&(e.addEventListener("input",a),e.addEventListener("input",e=>{t&&(t.value=e.target.value)}))}async function loadChurches(e=!1){if(!isLoading){var t=document.getElementById("churchesGrid");if(t&&(e&&(t.innerHTML="",currentPage=1,hasMorePages=!0),hasMorePages)){isLoading=!0,showLoading(t,e);try{var a=new URLSearchParams({page:currentPage,limit:12});currentState&&"all"!==currentState&&a.append("state",currentState),currentDenomination&&"all"!==currentDenomination&&a.append("denomination",currentDenomination),currentSearch&&a.append("search",currentSearch);var n=await(await fetch(apiUrl("churches.php")+"?"+a)).json();hideLoading(t),n.success&&n.data&&(0===n.data.length&&1===currentPage?showEmptyState(t):(renderChurches(t,n.data),n.pagination&&(hasMorePages=currentPage<n.pagination.total_pages,currentPage++,hasMorePages)&&showLoadMoreButton(t)))}catch(e){console.error("Failed to load churches:",e),hideLoading(t),showErrorState(t)}isLoading=!1}}}function showLoading(e,t){if(t){var a=1280<=window.innerWidth?8:1024<=window.innerWidth?6:640<=window.innerWidth?4:2;let t="";for(let e=0;e<a;e++)t+=`
                <div class="skeleton-card">
                    <div class="skeleton-card__image"></div>
                    <div class="skeleton-card__content">
                        <div class="skeleton skeleton-card__title"></div>
                        <div class="skeleton skeleton-card__text"></div>
                        <div class="skeleton skeleton-card__text skeleton-card__text--short"></div>
                    </div>
                </div>
            `;e.innerHTML=t}}function hideLoading(e){e.querySelectorAll(".skeleton-card").forEach(e=>e.remove());e=e.querySelector(".loading-state");e&&e.remove()}function showEmptyState(e){var t=window.AppConfig?.translations||{};e.innerHTML=`
        <div class="empty-state">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2L14 8H20L15 12L17 18L12 14L7 18L9 12L4 8H10L12 2Z" stroke="currentColor" stroke-width="2"/>
            </svg>
            <h3>${t.noChurchesFound||"No churches found"}</h3>
            <p>${t.noChurchesDesc||"Try adjusting your search or filter to find churches."}</p>
        </div>
    `}function showErrorState(e){var t=window.AppConfig?.translations||{};e.innerHTML=`
        <div class="empty-state">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                <path d="M12 8V12M12 16H12.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            <h3>${t.somethingWentWrong||"Something went wrong"}</h3>
            <p>${t.tryAgainLater||"Please try again later."}</p>
        </div>
    `}function showLoadMoreButton(e){var t=e.querySelector(".load-more-container"),t=(t&&t.remove(),window.AppConfig?.translations||{});let a=document.createElement("div");a.className="load-more-container",a.innerHTML=`<button class="load-more-btn">${t.loadMoreChurches||"Load More Churches"}</button>`,a.querySelector(".load-more-btn").addEventListener("click",()=>{a.remove(),loadChurches()}),e.appendChild(a)}function renderChurches(t,e){var a=t.querySelector(".load-more-container");a&&a.remove(),e.forEach(e=>{e=createChurchCard(e);t.appendChild(e)})}function createChurchCard(e){var t=document.createElement("article"),a=(t.className="church-card",e.image_url||assetUrl("images/placeholder.jpg")),n=[];e.phone&&n.push(`
            <a href="tel:${e.phone}" class="social-link" title="Call">
                <svg viewBox="0 0 24 24" fill="none"><path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72 12.84 12.84 0 00.7 2.81 2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45 12.84 12.84 0 002.81.7A2 2 0 0122 16.92z" stroke="currentColor" stroke-width="2"/></svg>
            </a>
        `),e.website&&n.push(`
            <a href="${e.website}" target="_blank" rel="noopener" class="social-link" title="Website">
                <svg viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/><path d="M2 12h20M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z" stroke="currentColor" stroke-width="2"/></svg>
            </a>
        `),e.facebook&&n.push(`
            <a href="https://facebook.com/${e.facebook}" target="_blank" rel="noopener" class="social-link" title="Facebook">
                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"/></svg>
            </a>
        `),e.instagram&&n.push(`
            <a href="https://instagram.com/${e.instagram}" target="_blank" rel="noopener" class="social-link" title="Instagram">
                <svg viewBox="0 0 24 24" fill="none"><rect x="2" y="2" width="20" height="20" rx="5" stroke="currentColor" stroke-width="2"/><circle cx="12" cy="12" r="4" stroke="currentColor" stroke-width="2"/><circle cx="18" cy="6" r="1" fill="currentColor"/></svg>
            </a>
        `),e.youtube&&n.push(`
            <a href="https://youtube.com/@${e.youtube}" target="_blank" rel="noopener" class="social-link" title="YouTube">
                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M22.54 6.42a2.78 2.78 0 00-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 00-1.94 2A29 29 0 001 11.75a29 29 0 00.46 5.33A2.78 2.78 0 003.4 19c1.72.46 8.6.46 8.6.46s6.88 0 8.6-.46a2.78 2.78 0 001.94-2 29 29 0 00.46-5.25 29 29 0 00-.46-5.33z"/><polygon points="9.75 15.02 15.5 11.75 9.75 8.48 9.75 15.02" fill="white"/></svg>
            </a>
        `);let r="";if(e.service_languages){var o=e.service_languages.split(",").filter(e=>e.trim());let a={bm:"BM",en:"EN",chinese:"中文",tamil:"தமிழ்",other:"+"};r=(r=o.map(e=>{var e=e.trim(),t=a[e]||e.toUpperCase();return`<span class="church-lang-badge church-lang-${e}">${escapeHtml(t)}</span>`}).join(""))&&`<div class="church-card-languages">${r}</div>`}return t.innerHTML=`
        <div class="church-card-image">
            <img src="${a}" alt="${escapeHtml(e.name)}" loading="lazy" onerror="this.parentElement.innerHTML='<div class=\\'church-card-image-placeholder\\'><svg viewBox=\\'0 0 24 24\\' fill=\\'none\\'><path d=\\'M18 21H6V12L3 12L12 3L21 12L18 12V21Z\\' stroke=\\'currentColor\\' stroke-width=\\'2\\' stroke-linecap=\\'round\\' stroke-linejoin=\\'round\\'/><path d=\\'M12 3V8\\' stroke=\\'currentColor\\' stroke-width=\\'2\\' stroke-linecap=\\'round\\'/><path d=\\'M9 21V15H15V21\\' stroke=\\'currentColor\\' stroke-width=\\'2\\' stroke-linecap=\\'round\\' stroke-linejoin=\\'round\\'/></svg></div>'">
        </div>
        <div class="church-card-content">
            <h3 class="church-card-name">
                <a href="${pageUrl("church.php?slug="+e.slug)}">${escapeHtml(e.name)}</a>
            </h3>
            ${e.denomination_name?`<div class="church-card-denomination">${escapeHtml(e.denomination_name)}</div>`:""}
            <div class="church-card-location">
                <svg viewBox="0 0 24 24" fill="none"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z" stroke="currentColor" stroke-width="2"/><circle cx="12" cy="10" r="3" stroke="currentColor" stroke-width="2"/></svg>
                <span>${escapeHtml(e.city||"")}${e.state_name?", "+escapeHtml(e.state_name):""}</span>
            </div>
            ${r}
            ${0<n.length?`<div class="church-card-social">${n.join("")}</div>`:""}
        </div>
    `,t}function escapeHtml(e){var t;return e?((t=document.createElement("div")).textContent=e,t.innerHTML):""}function initBackToTop(){let e=document.getElementById("backToTop");e&&(window.addEventListener("scroll",()=>{e.classList.toggle("visible",400<window.scrollY)}),e.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})}))}function getUrlParam(e){return new URLSearchParams(window.location.search).get(e)}document.addEventListener("DOMContentLoaded",()=>{var e=getUrlParam("state"),t=getUrlParam("search"),a=getUrlParam("denomination");e&&(currentState=e),a&&(currentDenomination=a),t&&(currentSearch=t,e=document.getElementById("searchInput"),a=document.getElementById("searchInputMobile"),e&&(e.value=t),a)&&(a.value=t)});